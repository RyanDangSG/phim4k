<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>RyanPhim - Mobile Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root { --primary: #ff5b00; --bg: #111; }
        body { background-color: var(--bg); color: #fff; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        
        /* Tối ưu thanh cuộn & lướt chạm */
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
        .snap-x { scroll-snap-type: x mandatory; }
        .snap-center { scroll-snap-align: center; }

        /* Menu Desktop Dropdown */
        .dropdown:hover .dropdown-menu { display: grid; opacity: 1; transform: translateY(0); pointer-events: auto; }
        .dropdown-menu {
            display: none; opacity: 0; transform: translateY(10px); transition: all 0.3s;
            position: absolute; top: 100%; left: 0;
            background: rgba(20, 20, 20, 0.98); backdrop-filter: blur(10px);
            border-top: 3px solid var(--primary); padding: 15px; border-radius: 0 0 8px 8px;
            grid-template-columns: repeat(3, 1fr); gap: 10px; min-width: 450px; z-index: 100;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
        }
        
        /* Mobile Menu Animation */
        #mobileMenu { transition: transform 0.3s ease-in-out; }
        .mobile-sub-menu { max-height: 0; overflow: hidden; transition: max-height 0.3s ease-out; }
        .mobile-sub-menu.open { max-height: 500px; overflow-y: auto; }

        .nav-item { cursor: pointer; transition: color 0.2s; }
        .nav-item.active { color: var(--primary); }
        .nav-item:hover { color: var(--primary); }
        
        /* Hiệu ứng ảnh */
        .movie-card img { transition: transform 0.3s; }
        @media (hover: hover) { .movie-card:hover img { transform: scale(1.1); filter: brightness(0.7); } }
        
        .page-btn {
            width: 36px; height: 36px; border-radius: 8px; display: flex; align-items: center; justify-content: center;
            background: #222; border: 1px solid rgba(255,255,255,0.1); font-weight: bold; font-size: 14px;
        }
        .page-btn.active { background: var(--primary); border-color: var(--primary); }
    </style>
</head>
<body class="bg-[#111] pb-20">

    <nav class="fixed w-full z-50 bg-[#151515]/95 border-b border-white/5 backdrop-blur-md h-14 md:h-16 shadow-lg transition-all" id="navbar">
        <div class="container mx-auto px-4 h-full flex justify-between items-center">
            
            <button class="xl:hidden text-white text-xl p-2" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>

            <h1 onclick="showHome()" class="text-2xl md:text-3xl font-black text-[#ff5b00] cursor-pointer italic tracking-tighter absolute left-1/2 -translate-x-1/2 xl:static xl:translate-x-0">RYANPHIM</h1>

            <div class="hidden xl:flex items-center gap-6 flex-1 justify-center font-bold text-sm uppercase text-gray-400">
                <a onclick="showHome()" class="nav-item active">Trang Chủ</a>
                <div class="dropdown nav-item group py-4 relative">
                    <span>Thể Loại <i class="fas fa-caret-down ml-1 text-xs"></i></span>
                    <div id="desktopGenre" class="dropdown-menu"></div>
                </div>
                <div class="dropdown nav-item group py-4 relative">
                    <span>Quốc Gia <i class="fas fa-caret-down ml-1 text-xs"></i></span>
                    <div id="desktopCountry" class="dropdown-menu" style="grid-template-columns: repeat(2, 1fr); min-width: 300px;"></div>
                </div>
                <a onclick="showCategory('danh-sach/phim-moi-cap-nhat', 'Phim Mới')" class="nav-item">Phim Mới</a>
                <a onclick="showCategory('danh-sach/phim-bo', 'Phim Bộ')" class="nav-item">Phim Bộ</a>
                <a onclick="showCategory('danh-sach/phim-le', 'Phim Lẻ')" class="nav-item">Phim Lẻ</a>
                <a onclick="showCategory('the-loai/phim-chieu-rap', 'Chiếu Rạp')" class="nav-item">Chiếu Rạp</a>
            </div>

            <div class="flex items-center gap-4">
                <div class="hidden md:flex items-center bg-[#222] px-3 py-1.5 rounded-full border border-white/10 w-64">
                    <input id="searchInput" type="text" placeholder="Tìm kiếm..." class="bg-transparent border-none outline-none text-xs w-full text-gray-300">
                    <i class="fas fa-search text-gray-500 cursor-pointer hover:text-orange-500" onclick="searchMovies()"></i>
                </div>
                <button class="md:hidden text-white text-lg p-2" onclick="toggleSearchOverlay()">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>
    </nav>

    <div id="mobileMenu" class="fixed inset-y-0 left-0 w-[80%] max-w-[300px] bg-[#1a1a1a] z-[60] transform -translate-x-full shadow-2xl border-r border-white/10 overflow-y-auto">
        <div class="p-5 border-b border-white/5 flex justify-between items-center bg-black/20">
            <span class="text-[#ff5b00] font-black text-xl italic">MENU</span>
            <button onclick="toggleMobileMenu()" class="text-gray-400"><i class="fas fa-times text-xl"></i></button>
        </div>
        <div class="p-4 space-y-4 text-sm font-bold uppercase text-gray-300">
            <a onclick="mobileNav('showHome')" class="block py-2 border-b border-white/5">Trang Chủ</a>
            <a onclick="mobileNav(`showCategory('danh-sach/phim-moi-cap-nhat', 'Phim Mới')`)" class="block py-2 border-b border-white/5">Phim Mới</a>
            <a onclick="mobileNav(`showCategory('danh-sach/phim-bo', 'Phim Bộ')`)" class="block py-2 border-b border-white/5">Phim Bộ</a>
            <a onclick="mobileNav(`showCategory('danh-sach/phim-le', 'Phim Lẻ')`)" class="block py-2 border-b border-white/5">Phim Lẻ</a>
            <a onclick="mobileNav(`showCategory('the-loai/phim-chieu-rap', 'Chiếu Rạp')`)" class="block py-2 border-b border-white/5 text-red-500">Phim Chiếu Rạp</a>
            
            <div>
                <div onclick="toggleAccordion('mobGenre')" class="flex justify-between items-center py-2 border-b border-white/5 cursor-pointer">
                    <span>Thể Loại</span> <i class="fas fa-chevron-down text-xs transition-transform" id="arrow_mobGenre"></i>
                </div>
                <div id="mobGenre" class="mobile-sub-menu bg-[#111] px-2 grid grid-cols-2 gap-2 text-[11px] text-gray-500 mt-2"></div>
            </div>

            <div>
                <div onclick="toggleAccordion('mobCountry')" class="flex justify-between items-center py-2 border-b border-white/5 cursor-pointer">
                    <span>Quốc Gia</span> <i class="fas fa-chevron-down text-xs transition-transform" id="arrow_mobCountry"></i>
                </div>
                <div id="mobCountry" class="mobile-sub-menu bg-[#111] px-2 grid grid-cols-2 gap-2 text-[11px] text-gray-500 mt-2"></div>
            </div>
        </div>
    </div>
    <div id="menuBackdrop" onclick="toggleMobileMenu()" class="fixed inset-0 bg-black/80 z-[55] hidden backdrop-blur-sm"></div>

    <div id="searchOverlay" class="fixed top-0 left-0 w-full h-16 bg-[#222] z-[70] hidden items-center px-4 border-b border-white/10">
        <input id="mobileSearchInput" type="text" placeholder="Nhập tên phim..." class="flex-1 bg-transparent text-white border-none outline-none text-sm h-full">
        <button onclick="mobileSearch()" class="text-[#ff5b00] font-bold text-sm uppercase px-3">Tìm</button>
        <button onclick="toggleSearchOverlay()" class="text-gray-400 px-2"><i class="fas fa-times"></i></button>
    </div>

    <main class="container mx-auto px-3 md:px-4 pt-16 md:pt-20 min-h-screen relative z-30">
        
        <section id="playerArea" class="hidden bg-[#151515] rounded-xl overflow-hidden shadow-2xl border border-white/10 mb-8 scroll-mt-20">
            <div class="aspect-video bg-black"><iframe id="mainIframe" class="w-full h-full" src="" frameborder="0" allowfullscreen></iframe></div>
            <div class="p-4 md:p-6">
                <div class="flex justify-between items-center mb-3">
                    <h2 id="playTitle" class="text-lg md:text-2xl font-bold text-orange-500 uppercase line-clamp-1"></h2>
                    <button onclick="document.getElementById('playerArea').classList.add('hidden')" class="text-gray-400 hover:text-white text-xs md:text-sm bg-white/10 px-3 py-1 rounded"><i class="fas fa-times mr-1"></i> Đóng</button>
                </div>
                <div id="epList" class="flex flex-wrap gap-2 max-h-40 overflow-y-auto custom-scrollbar"></div>
            </div>
        </section>

        <div id="homePage" class="animate-fade-in">
            <section id="hero" class="relative h-[55vh] md:h-[70vh] w-full bg-zinc-900 overflow-hidden rounded-xl md:rounded-2xl mb-8 group">
                <div class="absolute inset-0 bg-gradient-to-t from-[#111] via-transparent to-black/30 z-10"></div>
                <div id="bannerContent" class="absolute inset-0 z-20 flex items-end p-5 md:p-12 pb-10"></div>
                <img id="bannerImg" src="" class="absolute inset-0 w-full h-full object-cover opacity-80 transition duration-1000">
            </section>

            <div id="homeSections" class="space-y-8 md:space-y-12"></div>
        </div>

        <div id="categoryPage" class="hidden animate-fade-in">
            <div class="flex items-center justify-between mb-6 border-b border-white/10 pb-3">
                <h2 id="catTitle" class="text-xl md:text-3xl font-black text-white uppercase tracking-wide border-l-4 border-orange-500 pl-3">Danh Mục</h2>
                <button onclick="showHome()" class="text-xs md:text-sm text-gray-400 bg-[#222] px-3 py-1.5 rounded uppercase font-bold"><i class="fas fa-arrow-left mr-1"></i> Quay lại</button>
            </div>
            <div id="catGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 xl:grid-cols-6 gap-3 md:gap-6 min-h-[500px]"></div>
            <div id="pagination" class="flex justify-center items-center gap-1 md:gap-2 mt-8 flex-wrap"></div>
            <div id="loadingSpinner" class="hidden py-10 text-center"><div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-orange-500 border-t-transparent"></div></div>
        </div>
    </main>

    <footer class="py-8 text-center border-t border-white/5 opacity-40 text-[10px] uppercase font-bold tracking-widest">
        © 2026 RYANPHIM - Mobile Version
    </footer>

    <script>
        const API = 'https://ophim1.com/v1/api';
        const IMG_DOMAINS = ['https://img.ophim.live/uploads/movies/', 'https://phimimg.com/upload/poster/', 'https://img.otruyenapi.com/uploads/movies/'];
        let currentEndpoint = '', currentPage = 1;

        async function init() {
            loadBanner();
            loadDynamicMenus();
            
            loadHomeRow('danh-sach/phim-moi-cap-nhat', 'Phim Mới', 'orange');
            loadHomeRow('the-loai/phim-chieu-rap', 'Chiếu Rạp Hot', 'red');
            loadHomeRow('danh-sach/hoat-hinh', 'Hoạt Hình', 'green');
            loadHomeRow('danh-sach/phim-bo', 'Phim Bộ', 'blue');
            loadHomeRow('danh-sach/tv-shows', 'TV Shows', 'purple');
            
            document.getElementById('searchInput').onkeypress = (e) => { if(e.key === 'Enter') searchMovies(); };
            document.getElementById('mobileSearchInput').onkeypress = (e) => { if(e.key === 'Enter') mobileSearch(); };
        }

        // --- MOBILE UX FUNCTIONS ---
        function toggleMobileMenu() {
            const menu = document.getElementById('mobileMenu');
            const backdrop = document.getElementById('menuBackdrop');
            const isOpen = !menu.classList.contains('-translate-x-full');
            
            if(isOpen) {
                menu.classList.add('-translate-x-full');
                backdrop.classList.add('hidden');
            } else {
                menu.classList.remove('-translate-x-full');
                backdrop.classList.remove('hidden');
            }
        }

        function toggleSearchOverlay() {
            const ov = document.getElementById('searchOverlay');
            ov.classList.toggle('hidden');
            ov.classList.toggle('flex');
            if(ov.classList.contains('flex')) document.getElementById('mobileSearchInput').focus();
        }

        function toggleAccordion(id) {
            const el = document.getElementById(id);
            const arrow = document.getElementById(`arrow_${id}`);
            el.classList.toggle('open');
            arrow.style.transform = el.classList.contains('open') ? 'rotate(180deg)' : 'rotate(0deg)';
        }

        function mobileNav(action) {
            toggleMobileMenu();
            // Thực thi lệnh sau khi đóng menu
            setTimeout(() => { eval(action); }, 200);
        }

        function mobileSearch() {
            const kw = document.getElementById('mobileSearchInput').value;
            if(kw) {
                toggleSearchOverlay();
                showCategory(`tim-kiem?keyword=${kw}`, `Tìm kiếm: ${kw}`);
            }
        }

        // --- DATA LOADING ---
        async function loadDynamicMenus() {
            // Thể Loại
            try {
                const res = await fetch(`${API}/the-loai`).then(r => r.json());
                const items = res.data.items;
                const html = items.map(i => `<a onclick="showCategory('the-loai/${i.slug}', '${i.name}')" class="dropdown-item cursor-pointer block hover:bg-[#ff5b00] hover:text-white px-2 py-1 rounded">${i.name}</a>`).join('');
                document.getElementById('desktopGenre').innerHTML = html;
                document.getElementById('mobGenre').innerHTML = items.map(i => `<a onclick="mobileNav(\`showCategory('the-loai/${i.slug}', '${i.name}')\`)" class="py-2 border-b border-white/5 block text-gray-400">${i.name}</a>`).join('');
            } catch {}

            // Quốc Gia
            try {
                const res = await fetch(`${API}/quoc-gia`).then(r => r.json());
                const items = res.data.items;
                const html = items.map(i => `<a onclick="showCategory('quoc-gia/${i.slug}', '${i.name}')" class="dropdown-item cursor-pointer block hover:bg-[#ff5b00] hover:text-white px-2 py-1 rounded">${i.name}</a>`).join('');
                document.getElementById('desktopCountry').innerHTML = html;
                document.getElementById('mobCountry').innerHTML = items.map(i => `<a onclick="mobileNav(\`showCategory('quoc-gia/${i.slug}', '${i.name}')\`)" class="py-2 border-b border-white/5 block text-gray-400">${i.name}</a>`).join('');
            } catch {}
        }

        // --- MAIN LOGIC (Tương tự bản PC) ---
        function showHome() {
            document.getElementById('homePage').classList.remove('hidden');
            document.getElementById('categoryPage').classList.add('hidden');
            document.getElementById('playerArea').classList.add('hidden');
            window.scrollTo(0, 0);
        }

        async function showCategory(endpoint, title) {
            currentEndpoint = endpoint; currentPage = 1;
            document.getElementById('homePage').classList.add('hidden');
            document.getElementById('playerArea').classList.add('hidden');
            document.getElementById('categoryPage').classList.remove('hidden');
            document.getElementById('catTitle').innerText = title;
            loadCategoryPage();
        }

        async function loadCategoryPage() {
            const grid = document.getElementById('catGrid');
            const pag = document.getElementById('pagination');
            const spinner = document.getElementById('loadingSpinner');
            grid.innerHTML = ''; pag.innerHTML = ''; spinner.classList.remove('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });

            try {
                const res = await fetch(`${API}/${currentEndpoint}?page=${currentPage}`).then(r=>r.json());
                const movies = res.data.items;
                const totalItems = res.data.params?.pagination?.totalItems || 1000;
                spinner.classList.add('hidden');
                if(!movies || movies.length===0) { grid.innerHTML='<p class="col-span-full text-center text-gray-500">Không có phim.</p>'; return; }
                renderGrid(movies, 'catGrid');
                renderPagination(totalItems);
            } catch { spinner.classList.add('hidden'); }
        }

        function renderPagination(totalItems) {
            const totalPages = Math.min(Math.ceil(totalItems / 24), 50);
            let html = '';
            if(currentPage > 1) html += `<button onclick="changePage(${currentPage-1})" class="page-btn"><i class="fas fa-chevron-left"></i></button>`;
            let start = Math.max(1, currentPage - 1); // Mobile hiển thị ít nút hơn
            let end = Math.min(totalPages, currentPage + 1);
            if(start > 1) html += `<button onclick="changePage(1)" class="page-btn">1</button>`;
            for(let i=start; i<=end; i++) html += `<button onclick="changePage(${i})" class="page-btn ${i===currentPage?'active':''}">${i}</button>`;
            if(end < totalPages) html += `<button onclick="changePage(${totalPages})" class="page-btn">${totalPages}</button>`;
            if(currentPage < totalPages) html += `<button onclick="changePage(${currentPage+1})" class="page-btn"><i class="fas fa-chevron-right"></i></button>`;
            document.getElementById('pagination').innerHTML = html;
        }

        function changePage(p) { currentPage = p; loadCategoryPage(); }

        // --- RENDER HELPERS (Responsive) ---
        function getImgUrl(u) { return u.includes('http') ? u : `${IMG_DOMAINS[0]}${u}`; }
        function handleImgError(e) { 
            const s = e.src;
            if(s.includes(IMG_DOMAINS[0])) e.src = s.replace(IMG_DOMAINS[0], IMG_DOMAINS[1]);
            else if(s.includes(IMG_DOMAINS[1])) e.src = s.replace(IMG_DOMAINS[1], IMG_DOMAINS[2]);
            else e.src = 'https://via.placeholder.com/300x450?text=RyanPhim';
        }

        async function loadHomeRow(endpoint, title, color) {
            const res = await fetch(`${API}/${endpoint}?page=1`).then(r=>r.json()).catch(()=>({}));
            const movies = res.data?.items || [];
            if(movies.length === 0) return;
            
            const id = `sec_${endpoint.replace(/\//g,'')}`;
            const colors = {'orange':'bg-orange-500','red':'bg-red-600','green':'bg-green-500','blue':'bg-blue-500','purple':'bg-purple-500'};
            
            // Layout mobile: padding nhỏ, gap nhỏ
            document.getElementById('homeSections').innerHTML += `
                <div class="relative group" id="${id}">
                    <h2 class="text-base md:text-xl font-bold text-white mb-3 flex items-center gap-2 uppercase px-1">
                        <span class="w-1 h-5 ${colors[color]} rounded-full shadow-[0_0_10px_${color}]"></span> ${title}
                        <button onclick="showCategory('${endpoint}', '${title}')" class="text-[10px] bg-[#222] px-2 py-1 rounded text-gray-400 hover:text-white ml-auto border border-white/10">Xem thêm <i class="fas fa-chevron-right"></i></button>
                    </h2>
                    <div class="flex gap-3 overflow-x-auto hide-scroll snap-x pb-4 px-1">${movies.map(m => createCard(m)).join('')}</div>
                </div>`;
        }

        function createCard(m, isGrid=false) {
            // Mobile: Width nhỏ (130px), Desktop (200px)
            const widthClass = isGrid ? 'w-full' : 'w-[130px] md:w-[200px] flex-shrink-0 snap-center';
            return `
                <div onclick="playPhim('${m.slug}')" class="${widthClass} movie-card group cursor-pointer relative">
                    <div class="aspect-[2/3] rounded-lg overflow-hidden bg-[#222] border border-white/5 relative shadow-lg">
                        <img src="${getImgUrl(m.thumb_url)}" class="w-full h-full object-cover transition duration-500" onerror="handleImgError(this)" loading="lazy">
                        <div class="absolute top-1 left-1 md:top-2 md:left-2 bg-[#ff5b00] text-white text-[8px] md:text-[10px] font-bold px-1.5 py-0.5 rounded-sm shadow-md uppercase">${m.year||'New'}</div>
                    </div>
                    <div class="mt-2 px-1"><h3 class="text-[12px] md:text-[13px] font-bold text-gray-100 truncate group-hover:text-[#ff5b00] uppercase tracking-tight">${m.name}</h3></div>
                </div>`;
        }
        
        function renderGrid(movies, el) { document.getElementById(el).innerHTML = movies.map(m => createCard(m, true)).join(''); }

        async function loadBanner() {
            const res = await fetch(`${API}/home`).then(r=>r.json());
            const top = res.data.items[0];
            const img = document.getElementById('bannerImg');
            img.src = getImgUrl(top.thumb_url); img.onerror = ()=>handleImgError(img);
            document.getElementById('bannerContent').innerHTML = `
                <div class="max-w-4xl animate-fade-in-up">
                    <span class="bg-[#ff5b00] text-white text-[8px] md:text-[10px] px-2 py-0.5 rounded font-bold uppercase tracking-widest mb-2 inline-block shadow-lg">Trending #1</span>
                    <h2 class="text-2xl md:text-7xl font-black uppercase mb-4 italic tracking-tighter drop-shadow-2xl leading-none text-white line-clamp-2">${top.name}</h2>
                    <button onclick="playPhim('${top.slug}')" class="bg-white text-black px-6 py-2 md:px-8 md:py-3.5 rounded-sm font-black hover:bg-[#ff5b00] hover:text-white transition uppercase text-[10px] md:text-xs tracking-[0.25em] flex items-center gap-2 shadow-xl"><i class="fas fa-play"></i> Xem Ngay</button>
                </div>`;
        }

        async function playPhim(slug) {
            const res = await fetch(`${API}/phim/${slug}`).then(r=>r.json());
            const item = res.data.item;
            document.getElementById('playerArea').classList.remove('hidden');
            document.getElementById('playTitle').innerText = item.name;
            document.getElementById('epList').innerHTML = item.episodes[0].server_data.map(ep => `<button onclick="document.getElementById('mainIframe').src='${ep.link_embed}'" class="bg-[#222] hover:bg-[#ff5b00] hover:text-white text-gray-300 px-3 py-1.5 md:px-4 md:py-2 text-[10px] md:text-[11px] font-bold rounded transition border border-white/10 uppercase mb-1">${ep.name}</button>`).join('');
            document.getElementById('mainIframe').src = item.episodes[0].server_data[0].link_embed;
            document.getElementById('playerArea').scrollIntoView({behavior:'smooth', block:'center'});
        }

        async function searchMovies() {
            const kw = document.getElementById('searchInput').value;
            if(!kw) return;
            showCategory(`tim-kiem?keyword=${kw}`, `Tìm kiếm: ${kw}`);
        }

        init();
    </script>
</body>
</html>
